# Bank Churn Prediction API with AWS, FastAPI, and Snowflake

## Project Overview
This project implements an **end-to-end machine learning pipeline** for predicting customer churn in a bank. The workflow integrates **data storage, model training, API creation, and cloud deployment**:

1. **Data Source:** Bank churn dataset stored in **Snowflake**.
2. **Model:** Artificial Neural Network (ANN) using **TensorFlow**.
3. **Pipeline:** Preprocessing, encoding, scaling, and model wrapped into a **scikit-learn pipeline**.
4. **API:** **FastAPI** to serve predictions.
5. **Deployment:** Hosted on **AWS EC2** for global access.

---

## Model Details

- **Dataset:** Bank churn dataset.
- **Preprocessing:**
  - Cleaned dataset by handling missing values.
  - Encoded categorical columns `Geography` and `Gender`.
  - Scaled numerical features.
  - Handled class imbalance using **RandomOverSampler**.
- **Model Architecture:**
  - ANN with 2 hidden layers + 1 output layer.
  - Activation function: **ReLU** for hidden layers.
- **Evaluation Metrics:**

| Class | Precision | Recall | F1-score | Support |
|-------|----------|--------|----------|--------|
| 0     | 0.91     | 0.91   | 0.91     | 1593   |
| 1     | 0.64     | 0.63   | 0.64     | 407    |

- **Accuracy:** 0.85  
- **Macro Avg:** 0.77  
- **Weighted Avg:** 0.85  
- **ROC-AUC:** 0.769

---

## Pipeline
- Created a **custom scikit-learn pipeline**.
- Functions implemented:
  - `ColumnDropper` – drops unnecessary columns.
  - `EncodeAndScale` – encodes categorical features and scales numerical features.
  - **KerasClassifier wrapper** – wraps the TensorFlow ANN into the pipeline.
- Final pipeline saved as `final_pipeline.pkl`.

---

## Snowflake Integration
- **Snowflake DB** created to store the dataset.
- Predictions are logged into Snowflake after being generated by the API.

---

## FastAPI
- API uses `final_pipeline.pkl` and Snowflake DB.
- Input: `customer_id`.
- Workflow:
  1. Fetch customer data from Snowflake.
  2. Predict churn using the trained ANN model.
  3. Log prediction results into Snowflake.
- API Endpoint:  
  [http://65.2.140.99:8000/docs](http://65.2.140.99:8000/docs)

---

## AWS EC2 Deployment
- Created an **EC2 instance (Ubuntu)** on AWS.
- Uploaded all project files via SSH.
- Installed all necessary dependencies in a **Python virtual environment**.
- Hosted the FastAPI app using **Uvicorn** in the background.
- API accessible globally at `http://65.2.140.99:8000`.

- 
---

## Tech Stack
- **Python:** 3.10  
- **Libraries:** TensorFlow, scikit-learn, scikeras, FastAPI, boto3, Snowflake Connector  
- **Database:** Snowflake  
- **Deployment:** AWS EC2  

---

## How to Run
1. Clone the repository.
2. Install dependencies:
```bash
pip install -r requirements.txt ```

---

## Tech Stack
- **Python:** 3.10  
- **Libraries:** TensorFlow, scikit-learn, scikeras, FastAPI, boto3, Snowflake Connector  
- **Database:** Snowflake  
- **Deployment:** AWS EC2  

---

## How to Run
1. Clone the repository.
2. Install dependencies:
```bash
pip install -r requirements.txt

3. Set up Snowflake credentials in api.py.

4. Run FastAPI: uvicorn api:app --host 0.0.0.0 --port 8000

WORKFLOW -
         +----------------+
         |   Bank Churn   |
         |    Dataset     |
         |   (CSV/Raw)   |
         +----------------+
                 |
                 v
         +----------------+
         | Snowflake DB   | <-- Stores dataset & logs predictions
         +----------------+
                 |
         Fetch customer by ID
                 |
                 v
         +----------------+
         |  FastAPI API   | <-- Hosted on AWS EC2
         |  (api.py)      |
         +----------------+
                 |
                 v
         +----------------+
         | ANN Model      | <-- Wrapped in scikit-learn pipeline
         | (TensorFlow)   |
         +----------------+
                 |
                 v
        +-------------------+
        | Prediction Result | 
        +-------------------+
                 |
        Log prediction back to Snowflake
                 |
                 v
          +--------------+
          |   User/Code  |
          | Makes Request|
          +--------------+


